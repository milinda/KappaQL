# KappaQL

**KappaQL** is a SQL like Clojure DSL implementing
[Kappa](http://radar.oreilly.com/2014/07/questioning-the-lambda-architecture.html)
[Architecture](https://www.youtube.com/watch?v=fU9hR3kiOK0) proposed
originally by LinkedIn engineers [Jay
Kreps](https://twitter.com/jaykreps) and [Martin
Kleppmann](http://martin.kleppmann.com).

## What Is Kappa Architecture?

The general concept of DB. Web app architecture, you have a client talking to backend and backend talks to DB when it needs to query or store. Typically we keep application layer stateless to handle scalability, and state will be look from the DB. Works well with HTTP, because HTTP is stateless. DB is giant, global shared state. All those things such as actors, go routine trying to get rid of global shared memory. But databases are stuck with giant global mutable state. This is the way we building it for ages. What are the other possibilities of building these  stateful systems.

Look at 4 example which inspire us to think differently.

1. Replication - Write to master/leader, any writes that lead to this copied over to slaves/followers.

Update the product quantity in sample DB. Write first goes to master. Different implementations (WAL, Logical Log).

The replication message has a different characteristic for query

```
update cart set quantity = 3 where customer_id = 123 and product_id = 999
```

But replication message to slaves can be like following.

```
change row 8765
old = [123, 999, 1]
new= [123, 999, 3]
```

2. 

## Design and Implementation


### User Interaction (1st Prototype as of 10/02/2014)

1.  User starts the repl using `lein repl` from the KappaQL project base
    directory.
2.  Bootstrap the environment with information about Samza cluster(YARN,
Kafka and Zookeeper) and view storage(Cassandra/Redis).

    > Bootstrap will spawn a web server which expose views generated by
    > KappaQL.This web app will directly talk to view storage and
    > retrieve views.

3.  Write queries and submit them.
4.  Browse to KappaQL Views web app and view the output real-time.

### What Happens When User Runs A Query

*During the bootstrap process, project will get build, packed and uploaded to YARN. This makes sure we have all the required artifacts when original query is submitted.*

1.  Query compiler read cluster meta-data and generate execution plan.
2.  Then using Samza job submission tool we submit the real job to YARN.


### Implementation Plan

1.  Implement the first part of the bootstrap process where it builds the Samza cluster configuration.
2.  Design basic query DSL and execution.
3.  KappaQL Views web application.
